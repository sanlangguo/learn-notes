## 21-垃圾回收（二）：V8是如何优化垃圾回收器执行效率的

本文主要介绍了 V8 引擎是如何通过优化垃圾回收器的执行效率来提高 JavaScript 程序的性能。

### 全停顿
由于 JavaScript 是运行在主线程之上的，一旦执行垃圾回收算法，都需要将正在执行的 JavaScript 脚本暂停下来，待垃圾回收完毕后再恢复脚本执行。这种行为叫做全停顿（Stop-The-World）。全停顿会导致主线程上的其他任务暂停，从而影响程序的性能和用户体验。

### 优化
为了解决全停顿而造成的用户体验问题，V8 团队通过添加并行、并发和增量等垃圾回收技术，来提高垃圾回收器的执行效率。这些技术主要从两个方面来解决垃圾回收效率问题：

将一个完整的垃圾回收任务拆分成多个小任务，消灭单个长的垃圾回收任务。
将标记对象、移动对象等任务转移到后台线程中执行，减少对主线程的占用。

### 并行
并行是指在多个 CPU 上同时执行多个任务。V8 引擎使用了并行标记和并行清理两种技术来提高垃圾回收器的执行效率。

并行标记：将标记对象的任务分配给多个 CPU 执行，从而减少标记阶段的时间。V8 引擎使用了增量标记和并行标记两种技术来实现并行标记。

并行清理：将清理对象的任务分配给多个 CPU 执行，从而减少清理阶段的时间。V8 引擎使用了增量清理和并行清理两种技术来实现并行清理。

### 并发
并发是指在单个 CPU 上交替执行多个任务。V8 引擎使用了增量标记和增量整理两种技术来实现并发垃圾回收。

增量标记：将标记对象的任务分成多个阶段，在每个阶段之间执行 JavaScript 代码。这样可以让垃圾回收过程与 JavaScript 代码交替执行，减少全停顿的时间。

增量整理：将整理对象的任务分成多个阶段，在每个阶段之间执行 JavaScript 代码。这样可以让垃圾回收过程与 JavaScript 代码交替执行，减少全停顿的时间。

### 增量
增量是指将一个完整的垃圾回收任务分成多个小任务，在每个小任务之间执行 JavaScript 代码。这样可以让垃圾回收过程与 JavaScript 代码交替执行，减少全停顿的时间。V8 引擎使用了增量标记、增量整理和增量清理三种技术来实现增量垃圾回收。

### 总结
V8 引擎通过添加并行、并发和增量等垃圾回收技术，来提高垃圾回收器的执行效率，从而提高 JavaScript 程序的性能。